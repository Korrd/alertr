{% extends "base.html" %}

{% block title %}Events{% endblock %}

{% block content %}
<h1>Event Timeline</h1>

<section class="card">
    <form method="get" class="filters">
        <label>
            Severity:
            <select name="severity" onchange="this.form.submit()">
                <option value="">All</option>
                <option value="OK" {% if severity_filter == 'OK' %}selected{% endif %}>OK</option>
                <option value="WARN" {% if severity_filter == 'WARN' %}selected{% endif %}>WARN</option>
                <option value="CRIT" {% if severity_filter == 'CRIT' %}selected{% endif %}>CRIT</option>
            </select>
        </label>
        <label>
            Type:
            <select name="event_type" onchange="this.form.submit()">
                <option value="">All</option>
                <option value="state_change" {% if type_filter == 'state_change' %}selected{% endif %}>State Change</option>
                <option value="alert_sent" {% if type_filter == 'alert_sent' %}selected{% endif %}>Alert Sent</option>
                <option value="recovery" {% if type_filter == 'recovery' %}selected{% endif %}>Recovery</option>
                <option value="error" {% if type_filter == 'error' %}selected{% endif %}>Error</option>
            </select>
        </label>
        <a href="/events" class="btn btn-secondary">Clear Filters</a>
    </form>
</section>

<section class="card">
    {% if events %}
    <table class="table">
        <thead>
            <tr>
                <th>Time</th>
                <th>Type</th>
                <th>Severity</th>
                <th>Source</th>
                <th>Message</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
            <tr>
                <td class="nowrap">{{ event.ts }}</td>
                <td>
                    <span class="event-type type-{{ event.event_type }}">
                        {{ event.event_type }}
                    </span>
                </td>
                <td>
                    <span class="status-badge badge-{{ event.severity | lower }}">
                        {{ event.severity }}
                    </span>
                </td>
                <td>{{ event.source }}</td>
                <td>{{ event.message }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No events found matching the filters.</p>
    {% endif %}
</section>
{% endblock %}
